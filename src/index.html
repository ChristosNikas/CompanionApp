<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Companion App</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600&display=swap');

  :root {
    --bg:        #ffffff;
    --bg-2:      #f5f5f5;
    --bg-3:      #ebebeb;
    --fg:        #111111;
    --fg-dim:    #444444;
    --fg-muted:  #999999;
    --border:    #11111133;
    --border-hi: #11111166;
    --font-main: 'EB Garamond', Georgia, serif;
    --radius:    2px;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--fg);
    font-family: var(--font-main);
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    user-select: none;
    -webkit-app-region: drag;
  }

  /* ── Header ── */
  .logo {
    font-size: 0.75rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--fg-muted);
  }

  /* ── Timer ── */
  .timer {
    font-size: 2.2rem;
    font-weight: 400;
    letter-spacing: 0.05em;
    color: var(--fg);
    opacity: 0;
    transition: opacity 0.3s;
    font-variant-numeric: tabular-nums;
  }
  .timer.visible { opacity: 1; }

  /* ── Big Button ── */
  .track-btn {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    border: 1px solid var(--border-hi);
    background: var(--bg-2);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    transition: all 0.2s ease;
    -webkit-app-region: no-drag;
    outline: none;
    font-family: var(--font-main);
  }

  .track-btn:hover {
    background: var(--fg);
    color: var(--bg);
    border-color: var(--fg);
  }

  .track-btn.tracking {
    background: var(--fg);
    color: var(--bg);
    border-color: var(--fg);
  }

  .btn-icon {
    font-size: 1.8rem;
    line-height: 1;
  }

  .btn-label {
    font-size: 0.7rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
  }

  /* ── Status ── */
  .status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--fg-muted);
  }

  .status-dot {
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: var(--fg-muted);
    transition: background 0.3s;
  }

  .status-dot.active {
    background: var(--fg);
    animation: blink 1.5s infinite;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50%       { opacity: 0.3; }
  }

  /* ── Divider ── */
  .divider {
    width: 40px;
    height: 1px;
    background: var(--border-hi);
  }
</style>
</head>
<body>

<div class="logo">Scholar Vision</div>

<div class="divider"></div>

<div class="timer" id="timer">00:00:00</div>

<button class="track-btn idle" id="track-btn" onclick="toggleTracking()">
  <span class="btn-icon" id="btn-icon">▶</span>
  <span class="btn-label" id="btn-label">Start</span>
</button>

<div class="status">
  <div class="status-dot" id="status-dot"></div>
  <span id="status-text">Ready</span>
</div>

<script>
  let tracking = false;
  let startTime = null;
  let timerInterval = null;

  const btn       = document.getElementById('track-btn');
  const btnIcon   = document.getElementById('btn-icon');
  const btnLabel  = document.getElementById('btn-label');
  const statusDot = document.getElementById('status-dot');
  const statusTxt = document.getElementById('status-text');
  const timer     = document.getElementById('timer');

  function pad(n) { return String(n).padStart(2, '0'); }

  function updateTimer() {
    const diff = Math.floor((Date.now() - startTime) / 1000);
    const h = Math.floor(diff / 3600);
    const m = Math.floor((diff % 3600) / 60);
    const s = diff % 60;
    timer.textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
  }

  function toggleTracking() {
    tracking = !tracking;

    if (tracking) {
      startTime = Date.now();
      timerInterval = setInterval(updateTimer, 1000);

      btn.classList.replace('idle', 'tracking');
      btnIcon.textContent = '■';
      btnLabel.textContent = 'Stop';
      statusDot.classList.add('active');
      statusTxt.textContent = 'Tracking...';
      timer.classList.add('visible');

      if (window.electronAPI) window.electronAPI.startTracking();

    } else {
      clearInterval(timerInterval);

      btn.classList.replace('tracking', 'idle');
      btnIcon.textContent = '▶';
      btnLabel.textContent = 'Start';
      statusDot.classList.remove('active');
      statusTxt.textContent = 'Sending data...';
      timer.classList.remove('visible');

      if (window.electronAPI) {
        window.electronAPI.stopTracking();
        setTimeout(() => {
          statusTxt.textContent = 'Sending data...';
          window.electronAPI.flush().then(() => {
            statusTxt.textContent = 'Done!';
          });
        }, 1500);
      }
    }
  }
</script>
</body>
</html>